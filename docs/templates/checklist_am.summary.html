<!--
  Community Kitchen – Storage & Cleaning Checks (Summary HTML Template)

  Notes:
  - Keep placeholders as plain text tokens like {{FIELD_ID}} (do NOT split tokens across spans).
  - FILE_UPLOAD icons (HTML-only): {{FILES_ICON(FIELD_ID)}} opens the read-only Files overlay in-app.
  - This template is designed to be injected into the CK web app (not a standalone web page).
-->

<style>
  .ck-summary-template {
    /* inherit app typography; avoid fixed pt/px sizes so it scales nicely on iOS */
    color: var(--text);
    font-size: var(--ck-font-label); /* slightly denser than the app default */
    margin: -8px; /* counter the preview container padding so more content fits */
    font-family: var(--ck-font-family, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif);
  }

  .ck-summary-template * {
    box-sizing: border-box;
    max-width: 100%;
  }

  .ck-meta-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 8px;
    margin-bottom: 10px;
  }

  .ck-meta {
    border: none;
    background: transparent;
    border-radius: 0;
    padding: 10px 10px;
    min-width: 0;
  }

  .ck-meta-label {
    font-weight: 600;
    font-size: calc(var(--ck-font-label) * 0.85);
    letter-spacing: 0;
    text-transform: none;
    color: var(--muted);
    margin-bottom: 4px;
  }

  .ck-meta-value {
    font-weight: 600;
    font-size: calc(var(--ck-font-label) * 0.85);
    color: var(--text);
    line-height: 1.15;
    word-break: break-word;
    overflow-wrap: anywhere;
  }

  .ck-status-pill {
    display: inline;
    align-items: center;
    padding: 0;
    border-radius: 0;
    border: none;
    background: transparent;
    color: var(--text);
    font-weight: 600;
    font-size: calc(var(--ck-font-label) * 0.85);
    line-height: 1;
    white-space: nowrap;
  }
  .ck-status-pill[data-status-key="onClose"] {
    border-color: var(--border);
    background: transparent;
    color: var(--text);
  }
  .ck-status-pill[data-status-key="reOpened"] {
    border-color: var(--border);
    background: transparent;
    color: var(--text);
  }

  .ck-divider {
    border: 0;
    height: 1px;
    background: var(--border);
    margin: 10px 0;
  }

  .ck-section-title {
    margin: 0 0 8px 0;
    font-weight: 600;
    font-size: calc(var(--ck-font-label) * 0.85);
    letter-spacing: 0;
    text-transform: none;
    color: var(--muted);
  }

  .ck-subtitle {
    margin: 10px 0 8px 0;
    font-weight: 600;
    font-size: var(--ck-font-label);
    color: var(--text);
  }

  .ck-checklist {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
  }

  /* If a checklist has an odd number of items, make the last card span full width */
  .ck-checklist > .ck-check:last-child:nth-child(odd) {
    grid-column: 1 / -1;
  }

  .ck-check {
    border: none;
    background: transparent;
    border-radius: 0;
    padding: 8px 10px;
    display: flex;
    align-items: flex-start;
    gap: 8px;
    min-width: 0;
  }

  .ck-mark {
    flex: 0 0 auto;
    width: 1.6em;
    text-align: center;
    font-weight: 600;
    line-height: 1.2;
    font-size: var(--ck-font-control);
  }

  .ck-text {
    flex: 1 1 auto;
    min-width: 0;
    font-weight: 500;
    line-height: 1.2;
    color: var(--text);
    white-space: normal;
    word-break: break-word;
    overflow-wrap: anywhere;
  }

  .ck-right {
    flex: 0 0 auto;
    margin-left: auto;
    display: inline-flex;
    align-items: center;
  }

  /* If the FILES_ICON() placeholder renders nothing, don't reserve space */
  .ck-right:empty {
    display: none;
  }

  .ck-muted {
    color: var(--muted);
    font-weight: 500;
  }

  .ck-callouts {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
  }

  /* If there is only one callout, let it span full width */
  .ck-callouts > .ck-callout:last-child:nth-child(odd) {
    grid-column: 1 / -1;
  }

  .ck-callout {
    border: none;
    background: transparent;
    border-radius: 0;
    padding: 10px 10px;
    min-width: 0;
  }

  .ck-callout-title {
    font-weight: 600;
    font-size: calc(var(--ck-font-label) * 0.85);
    margin-bottom: 4px;
  }

  .ck-callout-body {
    font-weight: 500;
    line-height: 1.15;
    word-break: break-word;
    overflow-wrap: anywhere;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    min-width: 0;
  }

  .ck-callout-text {
    flex: 1 1 auto;
    min-width: 0;
    white-space: normal;
  }

  .ck-callout-icon {
    flex: 0 0 auto;
  }

  /* If the FILES_ICON() placeholder renders nothing, don't reserve space */
  .ck-callout-icon:empty {
    display: none;
  }

  /* Make FILES_ICON buttons larger and easier to tap */
  .ck-summary-template .ck-file-icon {
    padding: 12px 14px !important;
    border-radius: 16px !important;
    font-size: var(--ck-font-control) !important;
    line-height: 1 !important;
  }

  /* Larger badge for visibility */
  .ck-summary-template .ck-file-icon__badge {
    min-width: 28px !important;
    height: 28px !important;
    padding: 0 8px !important;
    font-size: calc(var(--ck-font-label) * 0.85) !important;
  }

  /* Ultra-narrow devices: stack a bit to avoid unreadably tiny columns */
  @media (max-width: 330px) {
    .ck-meta-grid {
      grid-template-columns: 1fr 1fr;
    }
    .ck-callouts {
      grid-template-columns: 1fr;
    }
  }

  /* Consolidated "Issues" callout (Previous + Current shift in one card) */
  .ck-issues-card {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .ck-issues-header {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .ck-issues-title {
    font-weight: 600;
    font-size: var(--ck-font-control);
    letter-spacing: 0;
  }

  .ck-issues-status-icon {
    margin-left: auto;
    font-size: var(--ck-font-control);
    line-height: 1;
  }

  .ck-issues-empty {
    display: none;
    align-items: center;
    gap: 10px;
    font-weight: 600;
  }

  .ck-issues-row {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .ck-issues-subtitle {
    font-weight: 600;
    font-size: calc(var(--ck-font-label) * 0.85);
    letter-spacing: 0;
  }

  .ck-issues-body {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    min-width: 0;
    font-weight: 600;
    line-height: 1.15;
    word-break: break-word;
    overflow-wrap: anywhere;
    padding-left: 12px;
    border-left: 3px solid var(--border);
  }

  .ck-issues-text {
    flex: 1 1 auto;
    min-width: 0;
    white-space: normal;
  }

  .ck-issues-sep {
    flex: 0 0 auto;
    color: var(--muted);
    font-weight: 600;
  }

  .ck-issues-icon {
    flex: 0 0 auto;
  }

  .ck-issues-icon:empty {
    display: none;
  }

  .ck-issues-divider {
    border: 0;
    height: 1px;
    background: var(--border);
    margin: 0;
  }

  .ck-callout.ck-issues--ok {
    border-color: var(--border);
    background: transparent;
  }

  .ck-callout.ck-issues--warn {
    border-color: var(--border);
    background: transparent;
  }
</style>

<div class="ck-summary-template">
  <div class="ck-meta-grid">
    <div class="ck-meta">
      <div class="ck-meta-label">{{LABEL(CHECK_FREQ)}}</div>
      <div class="ck-meta-value">{{CHECK_FREQ}}</div>
    </div>
    <div class="ck-meta">
      <div class="ck-meta-label">{{LABEL(DATE)}}</div>
      <div class="ck-meta-value">{{DATE}}</div>
    </div>
    <div class="ck-meta">
      <div class="ck-meta-label">{{LABEL(COOK)}}</div>
      <div class="ck-meta-value">{{COOK}}</div>
    </div>
    <div class="ck-meta">
      <div class="ck-meta-label">{{LABEL(STATUS)}}</div>
      <div class="ck-meta-value">
        <span class="ck-status-pill" data-status-key="{{STATUS_KEY}}">{{DEFAULT(STATUS, "—")}}</span>
      </div>
    </div>
  </div>

  <div class="ck-callouts">
    <div class="ck-callout ck-issues-card ck-issues--warn" data-ck-issues-card>
      <div class="ck-issues-header">
        <div class="ck-issues-title">{{LABEL(ISSUES)}}</div>
        <div class="ck-issues-status-icon" data-ck-issues-icon aria-hidden="true"></div>
      </div>

      <div class="ck-issues-empty" data-ck-issues-empty>
        <span aria-hidden="true"></span>
        <span>No issues</span>
      </div>

      <div class="ck-issues-row" data-ck-issues-prev-row>
        <div class="ck-issues-subtitle"><strong>{{LABEL(ISSUES_PREV)}}:</strong></div>
        <div class="ck-issues-body">
          <span class="ck-issues-text" data-ck-issues-prev-text>{{DEFAULT(ISSUES_PREV, "No issues")}}</span>
          <span class="ck-issues-sep" data-ck-issues-prev-sep aria-hidden="true">|</span>
          <span class="ck-issues-icon" data-ck-issues-prev-icon>{{FILES_ICON(ISSUES_PREV_EVD)}}</span>
        </div>
      </div>

      <hr class="ck-issues-divider" data-ck-issues-divider />

      <div class="ck-issues-row" data-ck-issues-current-row>
        <div class="ck-issues-subtitle"><strong>{{LABEL(ISSUES)}}:</strong></div>
        <div class="ck-issues-body">
          <span class="ck-issues-text" data-ck-issues-current-text>{{DEFAULT(ISSUES, "No issues")}}</span>
          <span class="ck-issues-sep" data-ck-issues-current-sep aria-hidden="true">|</span>
          <span class="ck-issues-icon" data-ck-issues-current-icon>{{FILES_ICON(ISSUES_EVD)}}</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      try {
        var card = document.querySelector('[data-ck-issues-card]');
        if (!card) return;
        if (card.getAttribute('data-ck-issues-init') === '1') return;
        card.setAttribute('data-ck-issues-init', '1');

        var normalize = function (s) {
          return (s || '').toString().trim().toLowerCase().replace(/\s+/g, ' ');
        };
        var isNoIssues = function (s) {
          var t = normalize(s);
          return t === '' || t === 'no issues' || t === 'no issue';
        };

        var prevTextEl = card.querySelector('[data-ck-issues-prev-text]');
        var currentTextEl = card.querySelector('[data-ck-issues-current-text]');
        var prevEmpty = isNoIssues(prevTextEl ? prevTextEl.textContent : '');
        var currentEmpty = isNoIssues(currentTextEl ? currentTextEl.textContent : '');

        var prevRow = card.querySelector('[data-ck-issues-prev-row]');
        var currentRow = card.querySelector('[data-ck-issues-current-row]');
        if (prevRow && prevEmpty) prevRow.style.display = 'none';
        if (currentRow && currentEmpty) currentRow.style.display = 'none';

        var divider = card.querySelector('[data-ck-issues-divider]');
        if (divider) divider.style.display = prevEmpty || currentEmpty ? 'none' : 'block';

        var hasIcon = function (el) {
          if (!el) return false;
          if (el.children && el.children.length) return true;
          return normalize(el.textContent) !== '';
        };
        var prevIcon = card.querySelector('[data-ck-issues-prev-icon]');
        var prevSep = card.querySelector('[data-ck-issues-prev-sep]');
        if (prevSep) prevSep.style.display = hasIcon(prevIcon) ? 'inline' : 'none';
        var currentIcon = card.querySelector('[data-ck-issues-current-icon]');
        var currentSep = card.querySelector('[data-ck-issues-current-sep]');
        if (currentSep) currentSep.style.display = hasIcon(currentIcon) ? 'inline' : 'none';

        var emptyBlock = card.querySelector('[data-ck-issues-empty]');
        var icon = card.querySelector('[data-ck-issues-icon]');
        if (prevEmpty && currentEmpty) {
          if (emptyBlock) emptyBlock.style.display = 'flex';
          if (icon) icon.textContent = '✅';
          card.classList.add('ck-issues--ok');
          card.classList.remove('ck-issues--warn');
        } else {
          if (emptyBlock) emptyBlock.style.display = 'none';
          if (icon) icon.textContent = '⚠️';
          card.classList.add('ck-issues--warn');
          card.classList.remove('ck-issues--ok');
        }
      } catch (e) {
        // ignore
      }
    })();
  </script>

  <hr class="ck-divider" />

  <div class="ck-section-title">Storage</div>

  <div class="ck-subtitle">Fridges</div>
  <ul class="ck-checklist">
    <li class="ck-check">
      <span class="ck-mark">{{FRIDGE_TEMP}}</span>
      <span class="ck-text">{{LABEL(FRIDGE_TEMP)}}</span>
      <span class="ck-right">{{FILES_ICON(FRIDGE_TEMP_PHOTO)}}</span>
    </li>
    <li class="ck-check"><span class="ck-mark">{{FRIDGE_LBD}}</span><span class="ck-text">{{LABEL(FRIDGE_LBD)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{FRIDGE_NBO}}</span><span class="ck-text">{{LABEL(FRIDGE_NBO)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{FRIDGE_FIF}}</span><span class="ck-text">{{LABEL(FRIDGE_FIF)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{FRIDGE_48H}}</span><span class="ck-text">{{LABEL(FRIDGE_48H)}}</span></li>
  </ul>

  <div class="ck-subtitle">Freezers</div>
  <ul class="ck-checklist">
    <li class="ck-check">
      <span class="ck-mark">{{FREEZER_TEMP}}</span>
      <span class="ck-text">{{LABEL(FREEZER_TEMP)}}</span>
      <span class="ck-right">{{FILES_ICON(FREEZER_TEMP_PHOTO)}}</span>
    </li>
    <li class="ck-check"><span class="ck-mark">{{FREEZER_FDS}}</span><span class="ck-text">{{LABEL(FREEZER_FDS)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{FREEZER_PKI}}</span><span class="ck-text">{{LABEL(FREEZER_PKI)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{FREEZER_FIF}}</span><span class="ck-text">{{LABEL(FREEZER_FIF)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{FREEZER_NEI}}</span><span class="ck-text">{{LABEL(FREEZER_NEI)}}</span></li>
  </ul>

  <div class="ck-subtitle">Vegetables</div>
  <ul class="ck-checklist">
    <li class="ck-check"><span class="ck-mark">{{FRESH_VEGGIES}}</span><span class="ck-text">{{LABEL(FRESH_VEGGIES)}}</span></li>
  </ul>

  <div class="ck-subtitle">Dry foods</div>
  <ul class="ck-checklist">
    <li class="ck-check"><span class="ck-mark">{{DRY_EXP}}</span><span class="ck-text">{{LABEL(DRY_EXP)}}</span></li>
  </ul>

  <hr class="ck-divider" />

  <div class="ck-section-title">Cleanliness</div>
  <ul class="ck-checklist">
    <li class="ck-check"><span class="ck-mark">{{CLEAN_STV}}</span><span class="ck-text">{{LABEL(CLEAN_STV)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_KEQ}}</span><span class="ck-text">{{LABEL(CLEAN_KEQ)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_CNT}}</span><span class="ck-text">{{LABEL(CLEAN_CNT)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_RICE}}</span><span class="ck-text">{{LABEL(CLEAN_RICE)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_OVN}}</span><span class="ck-text">{{LABEL(CLEAN_OVN)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_DSH}}</span><span class="ck-text">{{LABEL(CLEAN_DSH)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_BET}}</span><span class="ck-text">{{LABEL(CLEAN_BET)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_BLR}}</span><span class="ck-text">{{LABEL(CLEAN_BLR)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_CLTH}}</span><span class="ck-text">{{LABEL(CLEAN_CLTH)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_FLR}}</span><span class="ck-text">{{LABEL(CLEAN_FLR)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_BROOM}}</span><span class="ck-text">{{LABEL(CLEAN_BROOM)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_MOP}}</span><span class="ck-text">{{LABEL(CLEAN_MOP)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_EQP}}</span><span class="ck-text">{{LABEL(CLEAN_EQP)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_PEST}}</span><span class="ck-text">{{LABEL(CLEAN_PEST)}}</span></li>
    <li class="ck-check"><span class="ck-mark">{{CLEAN_DMG}}</span><span class="ck-text">{{LABEL(CLEAN_DMG)}}</span></li>
  </ul>
</div>
