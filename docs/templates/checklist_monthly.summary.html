<!--
  Community Kitchen – Storage & Cleaning Checks (Summary HTML Template)

  Notes:
  - Keep placeholders as plain text tokens like {{FIELD_ID}} (do NOT split tokens across spans).
  - FILE_UPLOAD icons (HTML-only): {{FILES_ICON(FIELD_ID)}} opens the read-only Files overlay in-app.
  - This template is designed to be injected into the CK web app (not a standalone web page).
-->

<style>
  .ck-summary-template {
    /* inherit app typography; avoid fixed pt/px sizes so it scales nicely on iOS */
    color: #0f172a;
    font-size: 0.94em; /* slightly denser than the app default */
    margin: -8px; /* counter the preview container padding so more content fits */
  }

  .ck-summary-template * {
    box-sizing: border-box;
    max-width: 100%;
  }

  .ck-meta-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 8px;
    margin-bottom: 10px;
  }

  .ck-meta {
    border: 1px solid rgba(148, 163, 184, 0.55);
    background: rgba(148, 163, 184, 0.1);
    border-radius: 12px;
    padding: 10px 10px;
    min-width: 0;
  }

  .ck-meta-label {
    font-weight: 800;
    font-size: 0.7em;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: rgba(15, 23, 42, 0.58);
    margin-bottom: 4px;
  }

  .ck-meta-value {
    font-weight: 900;
    font-size: 0.9em;
    color: #0f172a;
    line-height: 1.15;
    word-break: break-word;
    overflow-wrap: anywhere;
  }

  .ck-divider {
    border: 0;
    height: 1px;
    background: rgba(148, 163, 184, 0.55);
    margin: 10px 0;
  }

  .ck-section-title {
    margin: 0 0 8px 0;
    font-weight: 800;
    font-size: 0.88em;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: rgba(15, 23, 42, 0.72);
  }

  .ck-subtitle {
    margin: 10px 0 8px 0;
    font-weight: 900;
    font-size: 0.98em;
    color: #0f172a;
  }

  .ck-checklist {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
  }

  /* If a checklist has an odd number of items, make the last card span full width */
  .ck-checklist > .ck-check:last-child:nth-child(odd) {
    grid-column: 1 / -1;
  }

  .ck-check {
    border: 1px solid rgba(15, 23, 42, 0.1);
    background: rgba(118, 118, 128, 0.06);
    border-radius: 12px;
    padding: 8px 10px;
    display: flex;
    align-items: flex-start;
    gap: 8px;
    min-width: 0;
  }

  .ck-mark {
    flex: 0 0 auto;
    width: 1.6em;
    text-align: center;
    font-weight: 900;
    line-height: 1.2;
    font-size: 1.05em;
  }

  .ck-text {
    flex: 1 1 auto;
    min-width: 0;
    font-weight: 700;
    line-height: 1.2;
    color: rgba(15, 23, 42, 0.92);
    white-space: normal;
    word-break: break-word;
    overflow-wrap: anywhere;
  }

  .ck-right {
    flex: 0 0 auto;
    margin-left: auto;
    display: inline-flex;
    align-items: center;
  }

  /* If the FILES_ICON() placeholder renders nothing, don't reserve space */
  .ck-right:empty {
    display: none;
  }

  .ck-muted {
    color: rgba(15, 23, 42, 0.55);
    font-weight: 700;
  }

  .ck-callouts {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
  }

  /* If there is only one callout, let it span full width */
  .ck-callouts > .ck-callout:last-child:nth-child(odd) {
    grid-column: 1 / -1;
  }

  .ck-callout {
    border: 1px solid rgba(251, 146, 60, 0.55);
    background: rgba(251, 146, 60, 0.10);
    border-radius: 12px;
    padding: 10px 10px;
    min-width: 0;
  }

  .ck-callout-title {
    font-weight: 900;
    font-size: 0.82em;
    margin-bottom: 4px;
  }

  .ck-callout-body {
    font-weight: 700;
    line-height: 1.15;
    word-break: break-word;
    overflow-wrap: anywhere;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    min-width: 0;
  }

  .ck-callout-text {
    flex: 1 1 auto;
    min-width: 0;
    white-space: normal;
  }

  .ck-callout-icon {
    flex: 0 0 auto;
  }

  /* If the FILES_ICON() placeholder renders nothing, don't reserve space */
  .ck-callout-icon:empty {
    display: none;
  }

  /* Make FILES_ICON buttons larger and easier to tap */
  .ck-summary-template .ck-file-icon {
    padding: 12px 14px !important;
    border-radius: 16px !important;
    font-size: 22px !important;
    line-height: 1 !important;
  }

  /* Larger badge for visibility */
  .ck-summary-template .ck-file-icon__badge {
    min-width: 28px !important;
    height: 28px !important;
    padding: 0 8px !important;
    font-size: 15px !important;
  }

  /* Ultra-narrow devices: stack a bit to avoid unreadably tiny columns */
  @media (max-width: 330px) {
    .ck-meta-grid {
      grid-template-columns: 1fr 1fr;
    }
    .ck-callouts {
      grid-template-columns: 1fr;
    }
  }

  /* "Issues" callout (single field: ISSUES + ISSUES_EVD) */
  .ck-issues-card {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .ck-issues-header {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .ck-issues-title {
    font-weight: 950;
    font-size: 1.02em;
    letter-spacing: 0.01em;
  }

  .ck-issues-status-icon {
    margin-left: auto;
    font-size: 1.25em;
    line-height: 1;
  }

  .ck-issues-empty {
    display: none;
    align-items: center;
    gap: 10px;
    font-weight: 900;
  }

  .ck-issues-row {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .ck-issues-subtitle {
    font-weight: 900;
    font-size: 0.9em;
    letter-spacing: 0.01em;
  }

  .ck-issues-body {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    min-width: 0;
    font-weight: 750;
    line-height: 1.15;
    word-break: break-word;
    overflow-wrap: anywhere;
    padding-left: 12px;
    border-left: 3px solid rgba(15, 23, 42, 0.12);
  }

  .ck-issues-text {
    flex: 1 1 auto;
    min-width: 0;
    white-space: normal;
  }

  .ck-issues-sep {
    flex: 0 0 auto;
    color: rgba(15, 23, 42, 0.38);
    font-weight: 900;
  }

  .ck-issues-icon {
    flex: 0 0 auto;
  }

  .ck-issues-icon:empty {
    display: none;
  }

  .ck-callout.ck-issues--ok {
    border-color: rgba(34, 197, 94, 0.55);
    background: rgba(34, 197, 94, 0.12);
  }

  .ck-callout.ck-issues--warn {
    border-color: rgba(245, 158, 11, 0.7);
    background: rgba(245, 158, 11, 0.14);
  }
</style>

<div class="ck-summary-template">
  <div class="ck-meta-grid">
    <div class="ck-meta">
      <div class="ck-meta-label">Check frequency</div>
      <div class="ck-meta-value">{{CHECK_FREQ}}</div>
    </div>
    <div class="ck-meta">
      <div class="ck-meta-label">Date</div>
      <div class="ck-meta-value">{{DATE}}</div>
    </div>
    <div class="ck-meta">
      <div class="ck-meta-label">Responsible</div>
      <div class="ck-meta-value">{{COOK}}</div>
    </div>
  </div>

  <div class="ck-callouts">
    <div class="ck-callout ck-issues-card ck-issues--warn" data-ck-issues-card>
      <div class="ck-issues-header">
        <div class="ck-issues-title">Issues</div>
        <div class="ck-issues-status-icon" data-ck-issues-icon aria-hidden="true">⚠️</div>
      </div>

      <div class="ck-issues-empty" data-ck-issues-empty>
        <span aria-hidden="true">✅</span>
        <span>No issues</span>
      </div>

      <div class="ck-issues-row" data-ck-issues-row>
        <div class="ck-issues-subtitle"><strong>Issues reported:</strong></div>
        <div class="ck-issues-body">
          <span class="ck-issues-text" data-ck-issues-text>{{DEFAULT(ISSUES, "No issues")}}</span>
          <span class="ck-issues-sep" data-ck-issues-sep aria-hidden="true">|</span>
          <span class="ck-issues-icon" data-ck-issues-file-icon>{{FILES_ICON(ISSUES_EVD)}}</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      try {
        var card = document.querySelector('[data-ck-issues-card]');
        if (!card) return;
        if (card.getAttribute('data-ck-issues-init') === '1') return;
        card.setAttribute('data-ck-issues-init', '1');

        var normalize = function (s) {
          return (s || '').toString().trim().toLowerCase().replace(/\s+/g, ' ');
        };
        var isNoIssues = function (s) {
          var t = normalize(s);
          return t === '' || t === 'no issues' || t === 'no issue';
        };

        var textEl = card.querySelector('[data-ck-issues-text]');
        var empty = isNoIssues(textEl ? textEl.textContent : '');

        var row = card.querySelector('[data-ck-issues-row]');
        if (row && empty) row.style.display = 'none';

        var emptyBlock = card.querySelector('[data-ck-issues-empty]');
        var statusIcon = card.querySelector('[data-ck-issues-icon]');
        if (empty) {
          if (emptyBlock) emptyBlock.style.display = 'flex';
          if (statusIcon) statusIcon.textContent = '✅';
          card.classList.add('ck-issues--ok');
          card.classList.remove('ck-issues--warn');
        } else {
          if (emptyBlock) emptyBlock.style.display = 'none';
          if (statusIcon) statusIcon.textContent = '⚠️';
          card.classList.add('ck-issues--warn');
          card.classList.remove('ck-issues--ok');
        }

        var hasIcon = function (el) {
          if (!el) return false;
          if (el.children && el.children.length) return true;
          return normalize(el.textContent) !== '';
        };
        var fileIcon = card.querySelector('[data-ck-issues-file-icon]');
        var sep = card.querySelector('[data-ck-issues-sep]');
        if (sep) sep.style.display = !empty && hasIcon(fileIcon) ? 'inline' : 'none';
      } catch (e) {
        // ignore
      }
    })();
  </script>

  <hr class="ck-divider" />

  <div class="ck-section-title">Checks</div>

  <div class="ck-subtitle">Kitchen cleaning</div>
  <ul class="ck-checklist">
    <li class="ck-check">
      <span class="ck-mark">{{MH_OVEN}}</span>
      <span class="ck-text">Oven deep cleaning</span>
      <span class="ck-right">{{FILES_ICON(MH_OVEN_PH)}}</span>
    </li>
    <li class="ck-check">
      <span class="ck-mark">{{MH_EXH_DEEP}}</span>
      <span class="ck-text">Exhaust hood deep cleaned</span>
      <span class="ck-right">{{FILES_ICON(MH_EXH_DEEP_PH)}}</span>
    </li>
    <li class="ck-check">
      <span class="ck-mark">{{MH_DISH}}</span>
      <span class="ck-text">Dishwasher filter cleaned</span>
      <span class="ck-right">{{FILES_ICON(MH_DISH_PH)}}</span>
    </li>
    <li class="ck-check">
      <span class="ck-mark">{{MH_EXTR}}</span>
      <span class="ck-text">Extractor hood / filters cleaned</span>
      <span class="ck-right">{{FILES_ICON(MH_EXTR_PH)}}</span>
    </li>
    <li class="ck-check">
      <span class="ck-mark">{{MH_FRIDGE}}</span>
      <span class="ck-text">Fridge door seals cleaned & checked</span>
      <span class="ck-right">{{FILES_ICON(MH_FRIDGE_PH)}}</span>
    </li>
    <li class="ck-check">
      <span class="ck-mark">{{MH_FREEZER}}</span>
      <span class="ck-text">Freezer door seals cleaned & checked</span>
      <span class="ck-right">{{FILES_ICON(MH_FREEZER_PH)}}</span>
    </li>
  </ul>

  <div class="ck-subtitle">Storage inspection</div>
  <ul class="ck-checklist">
    <li class="ck-check"><span class="ck-mark">{{MH_DRY}}</span><span class="ck-text">Dry storage inspected</span></li>
  </ul>
</div>


